import gc
import sys
import time
from logging import getLogger

import joblib
import pandas as pd

from tools.utils.general_utils import (dec_timer, logInit, parse_args, sel_log,
                                       send_line_notification)


def e000_first_preprocess():
    trn_df = pd.read_csv('./inputs/origin/train.csv.zip', compression='zip')
    joblib(trn_df, './inputs/prep/train.jbl.gz', compress="gzip")
    tst_df = pd.read_csv('./inputs/origin/test.csv.zip', compression='zip')
    joblib(tst_df, './inputs/prep/train.jbl.gz', compress="gzip")


def preprocess(args, logger):
    if 'e000' in args.exp_ids:
        e000_first_preprocess()


if __name__ == '__main__':
    t0 = time.time()
    logger = getLogger(__name__)
    logger = logInit(logger, './logs/', 'preprocess.log')
    args = parse_args(logger)

    logger.info('')
    logger.info('')
    logger.info(
        f'============ EXP {args.exp_ids[0]}, START PREPROCESSING =============')
    preprocess(args, logger)
    prec_time = time.time() - t0
    send_line_notification(
        f'Finished: {" ".join(sys.argv)} in {prec_time:.1f} s !')
