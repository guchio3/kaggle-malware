import pandas as pd
from tools.utils.encoding import nnne
from tools.utils.feature_tools import load_features, save_features

fullav = pd.read_pickle('./inputs/nes_info/e005_avsig_ts_diff_full_trn.pkl.gz')
fullos = pd.read_pickle('./inputs/nes_info/e005_osver_ts_diff_full_trn.pkl.gz')

df = load_features(['MachineIdentifier', 'e005_avsig_ts_diff', 'e005_osver_ts_diff'], './inputs/features/', 3)
df = df.set_index('MachineIdentifier')

trn_idx = pd.read_pickle('./inputs/nes_info/trn_MachineIdentifier.pkl.gz')
df.loc[trn_idx.values, 'e005_avsig_ts_diff'] = fullav.values
df.loc[trn_idx.values, 'e005_osver_ts_diff'] = fullos.values

df = nnne(df)

df = df.rename(columns={'e005_avsig_ts_diff': 'nnne_e005_avsig_ts_diff_full_trn'})
df = df.rename(columns={'e005_osver_ts_diff': 'nnne_e005_osver_ts_diff_full_trn'})

save_features(df, './inputs/features/', 3)
