import pandas as pd


def e007_timestamp_features(df):
    res_df = pd.DataFrame()
    res_df['MachineIdentifier'] = df['MachineIdentifier']
    # unpack timestamp
    for col in ['DateAS', 'DateOS', 'DateBL']:
        res_df[col + '_hour'] = df[col].dt.hour
        res_df[col + '_day'] = df[col].dt.day
        res_df[col + '_dayofweek'] = df[col].dt.dayofweek
        res_df[col + '_month'] = df[col].dt.month
        res_df[col + '_quarter'] = df[col].dt.quarter
        res_df[col + '_year'] = df[col].dt.year
    # time diff features
    res_df['DateAS_minus_DateOS'] = (df.DateAS - df.DateOS).dt.days
    res_df['DateOS_minus_DateBL'] = (df.DateOS - df.DateBL).dt.days
    res_df['DateBL_minus_DateAS'] = (df.DateBL - df.DateAS).dt.days

    # add exp id to the col
    res_df.columns = ['e007_' + col if col !=
                      'MachineIdentifier' else col for col in res_df.columns]
    return res_df
